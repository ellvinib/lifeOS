{
  "name": "finance",
  "version": "1.0.0",
  "description": "Invoice and transaction management with AI-powered extraction and smart matching for Belgian businesses",
  "author": "LifeOS",
  "license": "MIT",
  "main": "src/index.ts",
  "permissions": [
    "files.write",
    "files.read",
    "events.publish",
    "events.subscribe",
    "database.read",
    "database.write"
  ],
  "dependencies": {
    "core": "^1.0.0"
  },
  "peerDependencies": {
    "@prisma/client": "^5.0.0",
    "express": "^4.18.0",
    "multer": "^1.4.0",
    "zod": "^3.22.0"
  },
  "events": {
    "subscribes": [
      "UserCreated",
      "BankAccountConnected",
      "MonthEndTriggered"
    ],
    "publishes": [
      "InvoiceUploaded",
      "InvoiceExtractionStarted",
      "InvoiceExtractionCompleted",
      "InvoiceExtractionFailed",
      "InvoiceDataExtracted",
      "InvoiceUpdated",
      "InvoiceDeleted",
      "InvoiceMatched",
      "InvoiceUnmatched",
      "TransactionsImported",
      "TransactionUpdated",
      "TransactionIgnored",
      "TransactionUnignored",
      "TransactionDeleted",
      "VendorCreated",
      "VendorUpdated",
      "MatchConfirmed",
      "MatchReverted"
    ]
  },
  "routes": {
    "baseUrl": "/api/finance",
    "endpoints": [
      "/invoices",
      "/invoices/:id",
      "/invoices/upload",
      "/invoices/:id/extract",
      "/invoices/:id/download",
      "/invoices/batch/extract",
      "/invoices/batch/delete",
      "/transactions",
      "/transactions/:id",
      "/transactions/import",
      "/transactions/import/preview",
      "/transactions/:id/ignore",
      "/transactions/:id/unignore",
      "/transactions/:id/soft-delete",
      "/transactions/batch/update-category",
      "/transactions/batch/delete",
      "/matches/suggest/:invoiceId",
      "/matches/suggest/bulk",
      "/matches/confirm",
      "/matches/confirm/auto",
      "/matches/unmatch/:matchId",
      "/matches/unmatch",
      "/webhooks/mailgun"
    ]
  },
  "jobs": [
    {
      "name": "process-invoice-email",
      "description": "Process incoming invoice emails from Mailgun webhook",
      "schedule": null,
      "priority": "normal"
    },
    {
      "name": "extract-invoice-data",
      "description": "Extract data from invoice PDF using AI",
      "schedule": null,
      "priority": "normal"
    },
    {
      "name": "auto-match-invoices",
      "description": "Auto-match invoices to transactions based on scoring algorithm",
      "schedule": "0 2 * * *",
      "priority": "low"
    },
    {
      "name": "mark-overdue-invoices",
      "description": "Mark invoices as overdue when due date passes",
      "schedule": "0 0 * * *",
      "priority": "low"
    }
  ],
  "config": {
    "geminiApiKey": {
      "type": "string",
      "required": false,
      "default": null,
      "description": "Google Gemini API key for invoice extraction (free tier: 1,500 requests/day)",
      "env": "GEMINI_API_KEY"
    },
    "mailgunSigningKey": {
      "type": "string",
      "required": false,
      "default": null,
      "description": "Mailgun webhook signing key for signature verification",
      "env": "MAILGUN_SIGNING_KEY"
    },
    "mailgunApiKey": {
      "type": "string",
      "required": false,
      "default": null,
      "description": "Mailgun API key for sending emails (optional)",
      "env": "MAILGUN_API_KEY"
    },
    "fileStoragePath": {
      "type": "string",
      "required": true,
      "default": "./data",
      "description": "Base path for invoice PDF storage (organized by year/month)",
      "env": "FILE_STORAGE_PATH"
    },
    "autoExtractOnUpload": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "Automatically trigger AI extraction when invoice is uploaded"
    },
    "autoMatchThreshold": {
      "type": "number",
      "required": false,
      "default": 90,
      "description": "Minimum score (0-100) required for automatic invoice-transaction matching"
    },
    "dateMatchToleranceDays": {
      "type": "number",
      "required": false,
      "default": 7,
      "description": "Number of days +/- to consider for transaction date matching"
    },
    "amountMatchTolerancePercent": {
      "type": "number",
      "required": false,
      "default": 5,
      "description": "Percentage tolerance for amount matching (e.g., 5 = Â±5%)"
    }
  },
  "database": {
    "tables": [
      "finance_vendors",
      "finance_invoices",
      "finance_invoice_transaction_matches"
    ],
    "migrations": "../../api/prisma/migrations"
  },
  "features": {
    "invoice_management": {
      "description": "Upload, extract, and manage invoices with AI-powered data extraction",
      "enabled": true
    },
    "transaction_import": {
      "description": "Import bank transactions from Belgian CSV files (Belfius, KBC, ING)",
      "enabled": true
    },
    "smart_matching": {
      "description": "Intelligent invoice-transaction matching with scoring algorithm",
      "enabled": true
    },
    "email_automation": {
      "description": "Automatic invoice processing from forwarded emails via Mailgun",
      "enabled": false,
      "requires": ["mailgunSigningKey"]
    },
    "scheduled_jobs": {
      "description": "Background jobs for auto-matching, overdue marking, and monthly reports",
      "enabled": false,
      "requires": ["redis"]
    }
  },
  "documentation": {
    "readme": "README.md",
    "api": "docs/API.md",
    "setup": "docs/SETUP.md",
    "examples": "docs/EXAMPLES.md"
  },
  "tags": [
    "finance",
    "invoicing",
    "accounting",
    "ai-extraction",
    "belgian-banking",
    "transaction-matching"
  ]
}
